<!DOCTYPE html>
<html>
<head>
	<title>Merquero</title>
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
</head>

<style type="text/css">
	ul{
		list-style: none;
	}

	.jumbotron{
		background-color: #fff;
	}

	.form-control-file{
		width: 40%
	}

</style>
<body>
<div id="app">
	<div class="navbar navbar-dark bg-dark box-shadow">
        <div class="container d-flex justify-content-between">
          <a href="#" class="navbar-brand d-flex align-items-center">
            
            <strong>Merquero Shop</strong>
          </a>
         
        </div>
      </div>
	

	<section class="jumbotron text-center">
		<div class="container">
          
         	<p class="lead text-muted">Upload CSV file for execute commands.</p>

         	
			<input @change="fileUpload()" type="file" id="file" name="file" ref="file" class="btn btn-primary my-2 form-control-file">
		
            <button v-on:click="submitFile()" class="btn btn-secondary my-2">Submit and Execute</button>
          </p>
        </div>
    </section>
	<div class="album py-5 bg-light">
	<div class="container">

		
		<div  class="row">
			<div v-for="item in products" class="col-md-4">
				<div class="card mb-4 box-shadow">

					<img class="card-img-top" :src="item.image">
					
						
					<div class="card-body">
						
							
							<h6>{{ item.name }} <br>
								<small >REF : {{ item.reference }}</small> <br><br>
								<small v-if="item.groups.length > 0" ><strong>This contains</strong></small>
								<small v-for="(group,index) in item.groups"> <br> {{ group.products[0].name }}</small>
							</h6>
							

							<span class="badge badge-secondary"><del> {{ item.price }} Price</del></span><br>
							<span class="badge badge-danger">{{ item.cost }} Cost</span><br>
							
							<small>{{ item.units }} Units</small> 
						

						<div class="d-flex justify-content-between align-items-center float-right ">
							<!--
	                    <div class="btn-group">
	                      <button type="button" class="btn btn-sm btn-outline-secondary">View</button>
	                      <button type="button" class="btn btn-sm btn-outline-secondary">Edit</button>
	                    </div>
	                    -->
	                   	<span v-show="item.status.name == 'Inactive'" class="badge badge-danger">{{ item.status.name }}</span>
	                    <span v-show="item.status.name == 'Active'" class="badge badge-success">{{ item.status.name }}</span>

	                  </div>
					</div>
				</div>
			</div>
		</div> 
	</div>
	</div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.5.17/vue.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@7.29.1/dist/sweetalert2.all.min.js"></script>
<script src="https://unpkg.com/vue-upload-component"></script>

<script type="text/javascript">
	
	Vue.component('file-upload', VueUploadComponent)
	
	const app = new Vue({
		el :'#app',
		file : '',
		data : {
			products : [],
		},
		mounted : function(){
			this.getProducts()
		},
		methods:{
			fileUpload(){
				
				this.file = this.$refs.file.files[0]
			},
			submitFile(){
				let formData = new FormData()
				formData.append('file', this.file)

				let url = 'http://127.0.0.1:8000/api/csv/'
				
				axios
				.post(url,
				  formData,
				  {
				    headers: {
				        'Content-Type': 'application/json'
				    }
				  }
				)
				.then(function(response){
				  console.log(response.request + ' SUCCESS!!');
				})
				.catch(function(){
				  console.log('FAILURE!!');
				})

			},
			getProducts(){
				let url = 'http://127.0.0.1:8000/api/products/'

				axios
			      .get(url)
			      .then(response => {
			      	this.products = response.data.data
			      })
			      .catch(error => {
			        console.log(error)
			      })
			}
		}
	})
</script>
</body>
</html>